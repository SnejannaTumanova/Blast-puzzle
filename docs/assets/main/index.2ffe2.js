window.__require=function t(e,o,i){function s(r,l){if(!o[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var a="function"==typeof __require&&__require;if(!l&&a)return a(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var h=o[r]={exports:{}};e[r][0].call(h.exports,function(t){return s(e[r][1][t]||t)},h,h.exports,t,e,o,i)}return o[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<i.length;r++)s(i[r]);return s}({BoostersProgress:[function(t,e,o){"use strict";cc._RF.push(e,"84a9auLJD1OHpGhICN1mdrb","BoostersProgress"),Object.defineProperty(o,"__esModule",{value:!0}),o.resetBoostersState=o.setBoostersState=o.getBoostersState=void 0;var i="boosters_swap_left",s="boosters_bomb_left";function n(t,e){return Number.isFinite(t)?Math.max(0,t):e}function r(t){cc.sys.localStorage.setItem(i,String(n(t.swapLeft,0))),cc.sys.localStorage.setItem(s,String(n(t.bombLeft,0)))}o.getBoostersState=function(t){var e=cc.sys.localStorage.getItem(i),o=cc.sys.localStorage.getItem(s),r=e?parseInt(e,10):t.swapLeft,l=o?parseInt(o,10):t.bombLeft;return{swapLeft:n(r,t.swapLeft),bombLeft:n(l,t.bombLeft)}},o.setBoostersState=r,o.resetBoostersState=function(t){r(t)},cc._RF.pop()},{}],BoostersView:[function(t,e,o){"use strict";cc._RF.push(e,"3b57cV3kVVG67ZPr4+6w9Hk","BoostersView");var i,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var s,n=arguments.length,r=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(n<3?s(r):n>3?s(e,o,r):s(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,c=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.swapButton=null,e.swapCountLabel=null,e.bombButton=null,e.bombCountLabel=null,e.swapSelected=null,e.bombSelected=null,e.onSwapClick=null,e.onBombClick=null,e.active="none",e.swapEnabled=!0,e.bombEnabled=!0,e}return s(e,t),e.prototype.onEnable=function(){var t,e;null===(t=this.swapButton)||void 0===t||t.on(cc.Node.EventType.TOUCH_END,this.handleSwap,this),null===(e=this.bombButton)||void 0===e||e.on(cc.Node.EventType.TOUCH_END,this.handleBomb,this),this.setActiveBooster("none")},e.prototype.onDisable=function(){var t,e;null===(t=this.swapButton)||void 0===t||t.off(cc.Node.EventType.TOUCH_END,this.handleSwap,this),null===(e=this.bombButton)||void 0===e||e.off(cc.Node.EventType.TOUCH_END,this.handleBomb,this)},e.prototype.setSwapCount=function(t){this.swapCountLabel&&(this.swapCountLabel.string=String(t)),this.swapEnabled=t>0,this.applyDisabledVisual(this.swapButton,this.swapEnabled),t<=0&&"swap"===this.active?this.setActiveBooster("none"):this.applyPulseVisual(this.swapButton,"swap"===this.active)},e.prototype.setBombCount=function(t){this.bombCountLabel&&(this.bombCountLabel.string=String(t)),this.bombEnabled=t>0,this.applyDisabledVisual(this.bombButton,this.bombEnabled),t<=0&&"bomb"===this.active?this.setActiveBooster("none"):this.applyPulseVisual(this.bombButton,"bomb"===this.active)},e.prototype.setActiveBooster=function(t){this.active=t,this.swapSelected&&(this.swapSelected.active="swap"===t),this.bombSelected&&(this.bombSelected.active="bomb"===t),this.syncButtonVisual(this.swapButton,"swap"===t,this.swapEnabled),this.syncButtonVisual(this.bombButton,"bomb"===t,this.bombEnabled)},e.prototype.syncButtonVisual=function(t,e,o){t&&t.isValid&&(this.stopActionByTagSafe(t,1002),this.stopActionByTagSafe(t,1001),t.scale=1,o&&e&&this.applyPulseVisual(t,!0))},e.prototype.applyDisabledVisual=function(t,e){t&&t.isValid&&(t.opacity=e?255:120,e||(this.stopActionByTagSafe(t,1001),this.stopActionByTagSafe(t,1002),t.scale=1))},e.prototype.applyPulseVisual=function(t,e){if(t&&t.isValid)if(this.stopActionByTagSafe(t,1001),e){t.scale=1.06;var o=cc.repeatForever(cc.sequence(cc.scaleTo(.35,1.06),cc.scaleTo(.35,1.03)));o.setTag&&o.setTag(1001),t.runAction(o)}else t.scale=1},e.prototype.handleSwap=function(){var t;this.swapEnabled&&(this.pressAnim(this.swapButton,"swap"),null===(t=this.onSwapClick)||void 0===t||t.call(this))},e.prototype.handleBomb=function(){var t;this.bombEnabled&&(this.pressAnim(this.bombButton,"bomb"),null===(t=this.onBombClick)||void 0===t||t.call(this))},e.prototype.pressAnim=function(t,e){if(t&&t.isValid){this.stopActionByTagSafe(t,1002);var o="swap"===e&&"swap"===this.active&&this.swapEnabled||"bomb"===e&&"bomb"===this.active&&this.bombEnabled?1.06:1,i=cc.sequence(cc.scaleTo(.06,.94*o),cc.scaleTo(.08,o));i.setTag&&i.setTag(1002),t.runAction(i)}},e.prototype.stopActionByTagSafe=function(t,e){t.stopActionByTag?t.stopActionByTag(e):t.stopAllActions()},n([c(cc.Node)],e.prototype,"swapButton",void 0),n([c(cc.Label)],e.prototype,"swapCountLabel",void 0),n([c(cc.Node)],e.prototype,"bombButton",void 0),n([c(cc.Label)],e.prototype,"bombCountLabel",void 0),n([c(cc.Node)],e.prototype,"swapSelected",void 0),n([c(cc.Node)],e.prototype,"bombSelected",void 0),n([l],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],FieldModel:[function(t,e,o){"use strict";cc._RF.push(e,"79942FRNQRLNaAulbr07fCb","FieldModel"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./TileModel"),s=function(){function t(t,e){this.colors=[i.TileColor.Red,i.TileColor.Green,i.TileColor.Blue,i.TileColor.Yellow,i.TileColor.Purple],this.MAX_REGEN_TRIES=20,this.width=t,this.height=e,this.grid=[],this.generate()}return t.prototype.generate=function(t){void 0===t&&(t=2);for(var e=0;e<this.MAX_REGEN_TRIES;e++){this.grid=[];for(var o=0;o<this.height;o++){for(var i=[],s=0;s<this.width;s++)i.push(this.randomTile());this.grid.push(i)}if(this.hasAnyMove(t))return}},t.prototype.randomTile=function(){var t=this.colors[Math.floor(Math.random()*this.colors.length)];return new i.default(t)},t.prototype.isInside=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height},t.prototype.getTile=function(t,e){return this.isInside(t,e)?this.grid[e][t]:null},t.prototype.setTile=function(t,e,o){this.isInside(t,e)&&(this.grid[e][t]=o)},t.prototype.swapTiles=function(t,e){if(this.isInside(t.x,t.y)&&this.isInside(e.x,e.y)){var o=this.grid[t.y][t.x],i=this.grid[e.y][e.x];this.grid[t.y][t.x]=i,this.grid[e.y][e.x]=o}},t.prototype.getCellsInRadius=function(t,e,o){for(var i=[],s=e-o;s<=e+o;s++)for(var n=t-o;n<=t+o;n++)this.isInside(n,s)&&this.grid[s][n]&&i.push({x:n,y:s});return i},t.prototype.hasAnyMove=function(t){if(void 0===t&&(t=2),t<=1)return!0;if(2===t){for(var e=0;e<this.height;e++)for(var o=0;o<this.width;o++)if(l=this.grid[e][o]){var i=l.color;if(o+1<this.width){var s=this.grid[e][o+1];if(s&&s.color===i)return!0}if(e+1<this.height){var n=this.grid[e+1][o];if(n&&n.color===i)return!0}}return!1}var r=new Set;for(e=0;e<this.height;e++)for(o=0;o<this.width;o++){var l;if(l=this.grid[e][o]){var c=o+","+e;if(!r.has(c)){for(var a=this.findGroup(o,e),h=0,d=a;h<d.length;h++){var u=d[h];r.add(u.x+","+u.y)}if(a.length>=t)return!0}}}return!1},t.prototype.findGroup=function(t,e){var o=this,i=this.getTile(t,e);if(!i)return[];var s=i.color,n=[{x:t,y:e}],r=new Set,l=[],c=function(t,e){if(o.isInside(t,e)){var i=t+","+e;if(!r.has(i)){var l=o.grid[e][t];l&&l.color===s&&(r.add(i),n.push({x:t,y:e}))}}};for(r.add(t+","+e);n.length>0;){var a=n.pop();l.push(a),c(a.x+1,a.y),c(a.x-1,a.y),c(a.x,a.y+1),c(a.x,a.y-1)}return l},t.prototype.getBurnGroup=function(t,e,o){void 0===o&&(o=2);var i=this.findGroup(t,e);return i.length>=o?i:[]},t.prototype.applyBurn=function(t,e,o){void 0===e&&(e=!1),void 0===o&&(o=2);for(var i=0,s=t;i<s.length;i++){var n=s[i];this.isInside(n.x,n.y)&&(this.grid[n.y][n.x]=null)}this.collapseDown(),this.refillTop(),e&&!this.hasAnyMove(o)&&this.generate(o)},t.prototype.collapseDown=function(){for(var t,e=0;e<this.width;e++){for(var o=[],i=this.height-1;i>=0;i--){var s=this.grid[i][e];s&&o.push(s)}for(i=this.height-1;i>=0;i--){var n=this.height-1-i;this.grid[i][e]=null!==(t=o[n])&&void 0!==t?t:null}}},t.prototype.refillTop=function(){for(var t=0;t<this.height;t++)for(var e=0;e<this.width;e++)null===this.grid[t][e]&&(this.grid[t][e]=this.randomTile())},t}();o.default=s,cc._RF.pop()},{"./TileModel":"TileModel"}],FieldView:[function(t,e,o){"use strict";cc._RF.push(e,"cfae3gVAWFNUJOR+AmjWp7n","FieldView");var i,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var s,n=arguments.length,r=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(n<3?s(r):n>3?s(e,o,r):s(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("./TileView"),l=cc._decorator,c=l.ccclass,a=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tilePrefab=null,e.cellW=100,e.cellH=112,e.gap=10,e.offsetX=0,e.offsetY=0,e.debugDrawHitRects=!1,e.selectFrame=null,e.onTileClick=null,e.currentModel=null,e.isAnimating=!1,e.tileNodes=[],e.builtW=0,e.builtH=0,e.tilesRoot=null,e.debugRoot=null,e.debugGfx=null,e.inputEnabled=!0,e.selectedCell=null,e.selectNode=null,e}return s(e,t),e.prototype.setInputEnabled=function(t){this.inputEnabled=t},e.prototype.onLoad=function(){this.tilesRoot=new cc.Node("TilesRoot"),this.tilesRoot.parent=this.node,this.debugRoot=new cc.Node("DebugRoot"),this.debugRoot.parent=this.node,this.debugRoot.zIndex=999,this.debugGfx=this.debugRoot.addComponent(cc.Graphics),this.debugGfx.lineWidth=2,this.debugGfx.strokeColor=cc.Color.CYAN;var t=new cc.Node("SelectOverlay");t.parent=this.node,t.zIndex=1e3,t.opacity=0;var e=t.addComponent(cc.Sprite);e.spriteFrame=this.selectFrame,e.type=cc.Sprite.Type.SLICED,this.selectNode=t},e.prototype.onEnable=function(){this.enableInput()},e.prototype.onDisable=function(){this.disableInput()},e.prototype.onDestroy=function(){this.disableInput()},e.prototype.render=function(t){var e=this;this.currentModel=t,this.buildIfNeeded(t),this.syncToModelInstant(t),this.scheduleOnce(function(){return e.drawDebug()},0)},e.prototype.playBurn=function(t,e){var o=this;if(!t||0===t.length)return e();this.isAnimating=!0;for(var i=t.length,s=function(t){var s=t.y,r=n.getNode(t.x,s);if(!r)return 0==--i&&(n.isAnimating=!1,e()),"continue";cc.tween(r).to(.12,{scale:0}).call(function(){r.destroy(),o.setNode(t.x,s,null),0==--i&&(o.isAnimating=!1,e())}).start()},n=this,r=0,l=t;r<l.length;r++)s(l[r])},e.prototype.applyModelAnimated=function(t,e){var o,i,s,n=this;this.currentModel=t,this.buildIfNeeded(t),this.isAnimating=!0;for(var l=new Map,c=0;c<this.tileNodes.length;c++)for(var a=0;a<(null!==(i=null===(o=this.tileNodes[c])||void 0===o?void 0:o.length)&&void 0!==i?i:0);a++)(f=this.tileNodes[c][a])&&(y=f.getComponent(r.default))&&-1!==y.tileId&&l.set(y.tileId,f);var h=[];for(c=0;c<t.height;c++)h.push(new Array(t.width).fill(null));var d=[],u=new Set;for(c=0;c<t.height;c++)for(a=0;a<t.width;a++){var p=t.getTile(a,c);if(p){var f,v=p.id;if(f=null!==(s=l.get(v))&&void 0!==s?s:null){var y;u.add(v),h[c][a]=f,this.tilesRoot&&f.parent!==this.tilesRoot&&(f.parent=this.tilesRoot),(y=f.getComponent(r.default)).init(p);var b=this.cellToPos(a,c,t);d.push(cc.tween(f).to(.18,{position:cc.v3(b.x,b.y)}))}else{f=this.createTileNode(p),h[c][a]=f;var g=this.cellToPos(a,-2,t);f.setPosition(g.x,g.y),f.scale=1,b=this.cellToPos(a,c,t),d.push(cc.tween(f).to(.22,{position:cc.v3(b.x,b.y)}))}}}if(l.forEach(function(t,e){u.has(e)||t&&t.isValid&&t.destroy()}),this.tileNodes=h,0===d.length)return this.isAnimating=!1,e(),void this.scheduleOnce(function(){return n.drawDebug()},0);for(var w=d.length,m=0,_=d;m<_.length;m++)_[m].call(function(){0==--w&&(n.isAnimating=!1,e(),n.scheduleOnce(function(){return n.drawDebug()},0))}).start();this.scheduleOnce(function(){return n.drawSelectedCell()},0)},e.prototype.buildIfNeeded=function(t){if(this.builtW!==t.width||this.builtH!==t.height||!this.tileNodes.length){this.tilesRoot&&this.tilesRoot.removeAllChildren(),this.builtW=t.width,this.builtH=t.height;var e=t.width*this.cellW+(t.width-1)*this.gap,o=t.height*this.cellH+(t.height-1)*this.gap;this.node.setContentSize(e,o),this.node.setAnchorPoint(.5,.5),this.tileNodes=[];for(var i=0;i<t.height;i++)this.tileNodes.push(new Array(t.width).fill(null));for(i=0;i<t.height;i++)for(var s=0;s<t.width;s++){var n=t.getTile(s,i);n&&(this.tileNodes[i][s]=this.createTileNode(n))}this.syncAllPositionsInstant(t)}},e.prototype.syncToModelInstant=function(t){for(var e=0;e<t.height;e++)for(var o=0;o<t.width;o++){var i=t.getTile(o,e),s=this.tileNodes[e][o];i||!s?i&&!s&&(s=this.createTileNode(i),this.tileNodes[e][o]=s):(s.destroy(),this.tileNodes[e][o]=null)}this.syncAllPositionsInstant(t),this.refreshTilesFromModel(t)},e.prototype.refreshTilesFromModel=function(t){for(var e,o=0;o<t.height;o++)for(var i=0;i<t.width;i++){var s=this.tileNodes[o][i],n=t.getTile(i,o);s&&n&&(null===(e=s.getComponent(r.default))||void 0===e||e.init(n))}},e.prototype.syncAllPositionsInstant=function(t){for(var e=0;e<t.height;e++)for(var o=0;o<t.width;o++){var i=this.tileNodes[e][o];if(i){var s=this.cellToPos(o,e,t);i.setPosition(s.x,s.y),i.scale=1}}},e.prototype.createTileNode=function(t){var e,o=cc.instantiate(this.tilePrefab);return o.parent=this.tilesRoot?this.tilesRoot:this.node,null===(e=o.getComponent(r.default))||void 0===e||e.init(t),o},e.prototype.getBoardOrigin=function(t){var e=this.cellW+this.gap,o=this.cellH+this.gap,i=t.width*this.cellW+(t.width-1)*this.gap,s=t.height*this.cellH+(t.height-1)*this.gap;return{startX:-i/2+this.cellW/2+this.offsetX,startY:s/2-this.cellH/2+this.offsetY,stepX:e,stepY:o,totalW:i,totalH:s}},e.prototype.cellToPos=function(t,e,o){var i=this.getBoardOrigin(o);return{x:i.startX+t*i.stepX,y:i.startY-e*i.stepY}},e.prototype.getNode=function(t,e){return e<0||e>=this.tileNodes.length?null:t<0||t>=this.tileNodes[e].length?null:this.tileNodes[e][t]},e.prototype.setNode=function(t,e,o){e<0||e>=this.tileNodes.length||t<0||t>=this.tileNodes[e].length||(this.tileNodes[e][t]=o)},e.prototype.drawDebug=function(){var t=this;if(this.debugGfx){var e=this.debugGfx;if(e.clear(),this.debugDrawHitRects&&this.currentModel){e.lineWidth=2,e.strokeColor=cc.Color.CYAN;for(var o=0;o<this.currentModel.height;o++)for(var i=0;i<this.currentModel.width;i++){var s=this.cellToPos(i,o,this.currentModel);e.rect(s.x-this.cellW/2,s.y-this.cellH/2,this.cellW,this.cellH)}e.stroke(),this.scheduleOnce(function(){return t.drawSelectedCell()},0)}}},e.prototype.onLocalTouch=function(t){var e;if(this.inputEnabled&&!this.isAnimating&&this.currentModel){var o=t.getLocation(),i=this.node.convertToNodeSpaceAR(cc.v3(o.x,o.y)),s=this.getBoardOrigin(this.currentModel),n=-s.totalW/2+this.offsetX,r=s.totalH/2+this.offsetY,l=i.x-n,c=r-i.y;if(!(l<0||l>s.totalW||c<0||c>s.totalH)){var a=Math.floor(l/s.stepX),h=Math.floor(c/s.stepY);if(!(a<0||a>=this.currentModel.width||h<0||h>=this.currentModel.height)){var d=l-a*s.stepX<=this.cellW,u=c-h*s.stepY<=this.cellH;d&&u&&(t.stopPropagation(),null===(e=this.onTileClick)||void 0===e||e.call(this,a,h))}}}},e.prototype.enableInput=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onLocalTouch,this)},e.prototype.disableInput=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onLocalTouch,this)},e.prototype.showSelectedCell=function(t,e){this.selectedCell={x:t,y:e},this.drawSelectedCell()},e.prototype.clearSelectedCell=function(){this.selectedCell=null,this.selectNode&&this.selectNode.isValid&&(this.selectNode.stopAllActions(),this.selectNode.opacity=0,this.selectNode.scale=1)},e.prototype.drawSelectedCell=function(){if(this.selectNode&&this.currentModel&&this.selectedCell){var t=this.selectedCell,e=t.x,o=t.y,i=this.cellToPos(e,o,this.currentModel),s=this.cellW+12,n=this.cellH+12;this.selectNode.setPosition(i.x,i.y),this.selectNode.setContentSize(s,n),this.selectNode.stopAllActions(),this.selectNode.opacity=0,this.selectNode.scale=.9,this.selectNode.runAction(cc.spawn(cc.fadeTo(.1,255),cc.sequence(cc.scaleTo(.1,1.06),cc.scaleTo(.08,1))))}},n([a(cc.Prefab)],e.prototype,"tilePrefab",void 0),n([a],e.prototype,"cellW",void 0),n([a],e.prototype,"cellH",void 0),n([a],e.prototype,"gap",void 0),n([a],e.prototype,"offsetX",void 0),n([a],e.prototype,"offsetY",void 0),n([a],e.prototype,"debugDrawHitRects",void 0),n([a(cc.SpriteFrame)],e.prototype,"selectFrame",void 0),n([c],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./TileView":"TileView"}],GameController:[function(t,e,o){"use strict";cc._RF.push(e,"468614x+oFLupW/rO3AcEqk","GameController"),Object.defineProperty(o,"__esModule",{value:!0});var i,s=t("../config/BoostersProgress");(function(t){t.None="None",t.Bomb="Bomb",t.Swap_First="Swap_First",t.Swap_Second="Swap_Second"})(i||(i={}));var n=function(){function t(t,e,o,n,r){var l=this;this.MIN_GROUP=2,this.isBusy=!1,this.boosterMode=i.None,this.swapFirst=null,this.BOMB_RADIUS=2,this.DEFAULT_BOOSTERS={swapLeft:5,bombLeft:3},this.swapLeft=0,this.bombLeft=0,this.onGameEnd=null,this.fieldModel=t,this.gameState=e,this.fieldView=o,this.hudView=n,this.boostersView=r;var c=s.getBoostersState(this.DEFAULT_BOOSTERS);this.swapLeft=c.swapLeft,this.bombLeft=c.bombLeft,this.fieldView.onTileClick=function(t,e){return l.onTileClicked(t,e)},this.boostersView.onBombClick=function(){return l.toggleBombMode()},this.boostersView.onSwapClick=function(){return l.toggleSwapMode()},this.refreshAll()}return t.prototype.refreshAll=function(){var t,e,o,i;this.fieldView.render(this.fieldModel),null===(t=this.hudView)||void 0===t||t.setMoves(this.gameState.movesLeft),null===(e=this.hudView)||void 0===e||e.setScore(this.gameState.score,this.gameState.targetScore),null===(o=this.boostersView)||void 0===o||o.setSwapCount(this.swapLeft),null===(i=this.boostersView)||void 0===i||i.setBombCount(this.bombLeft),this.syncBoosterUI()},t.prototype.syncBoosterUI=function(){var t,e,o=this.boosterMode===i.Bomb?"bomb":this.boosterMode===i.Swap_First||this.boosterMode===i.Swap_Second?"swap":"none";null===(e=null===(t=this.boostersView)||void 0===t?void 0:t.setActiveBooster)||void 0===e||e.call(t,o)},t.prototype.saveBoosters=function(){s.setBoostersState({swapLeft:this.swapLeft,bombLeft:this.bombLeft})},t.prototype.resetBoosterMode=function(){var t,e;this.boosterMode=i.None,this.swapFirst=null,null===(e=null===(t=this.fieldView)||void 0===t?void 0:t.clearSelectedCell)||void 0===e||e.call(t),this.syncBoosterUI()},t.prototype.toggleBombMode=function(){var t,e;this.isBusy||this.bombLeft<=0||(this.boosterMode!==i.Bomb?(this.boosterMode=i.Bomb,this.swapFirst=null,null===(e=null===(t=this.fieldView)||void 0===t?void 0:t.clearSelectedCell)||void 0===e||e.call(t),this.syncBoosterUI()):this.resetBoosterMode())},t.prototype.toggleSwapMode=function(){var t,e;this.isBusy||this.swapLeft<=0||(this.boosterMode===i.Swap_First||this.boosterMode===i.Swap_Second?this.resetBoosterMode():(this.boosterMode=i.Swap_First,this.swapFirst=null,null===(e=null===(t=this.fieldView)||void 0===t?void 0:t.clearSelectedCell)||void 0===e||e.call(t),this.syncBoosterUI()))},t.prototype.onTileClicked=function(t,e){if(!(this.isBusy||this.gameState.movesLeft<=0))if(this.boosterMode===i.None){var o=this.fieldModel.getBurnGroup(t,e,this.MIN_GROUP);0!==o.length&&this.performBurnMove(o)}else this.handleBoosterClick(t,e)},t.prototype.handleBoosterClick=function(t,e){var o,s,n,r,l,c,a=this;switch(this.boosterMode){case i.Bomb:if(this.bombLeft<=0)return void this.resetBoosterMode();var h=this.fieldModel.getCellsInRadius(t,e,this.BOMB_RADIUS);return h&&0!==h.length?(this.bombLeft-=1,null===(o=this.boostersView)||void 0===o||o.setBombCount(this.bombLeft),this.saveBoosters(),this.performBurnMove(h),void this.resetBoosterMode()):void this.resetBoosterMode();case i.Swap_First:return this.swapLeft<=0?void this.resetBoosterMode():(this.swapFirst={x:t,y:e},this.boosterMode=i.Swap_Second,null===(n=null===(s=this.fieldView)||void 0===s?void 0:s.showSelectedCell)||void 0===n||n.call(s,t,e),void this.syncBoosterUI());case i.Swap_Second:if(this.swapLeft<=0)return void this.resetBoosterMode();if(!this.swapFirst)return this.boosterMode=i.Swap_First,void this.syncBoosterUI();var d=this.swapFirst,u={x:t,y:e};return d.x===u.x&&d.y===u.y?(this.swapFirst=null,this.boosterMode=i.Swap_First,null===(l=null===(r=this.fieldView)||void 0===r?void 0:r.clearSelectedCell)||void 0===l||l.call(r),void this.syncBoosterUI()):(this.swapLeft-=1,null===(c=this.boostersView)||void 0===c||c.setSwapCount(this.swapLeft),this.saveBoosters(),this.isBusy=!0,this.fieldModel.swapTiles(d,u),this.fieldView.applyModelAnimated(this.fieldModel,function(){var t,e,o,i;return a.gameState.movesLeft-=1,null===(t=a.hudView)||void 0===t||t.setMoves(a.gameState.movesLeft),null===(e=a.hudView)||void 0===e||e.setScore(a.gameState.score,a.gameState.targetScore),a.gameState.isLose()?(a.isBusy=!0,void(null===(o=a.onGameEnd)||void 0===o||o.call(a,"lose","\u0425\u043e\u0434\u044b \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c"))):a.fieldModel.hasAnyMove(a.MIN_GROUP)?void(a.isBusy=!1):(a.isBusy=!0,void(null===(i=a.onGameEnd)||void 0===i||i.call(a,"lose","\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0445\u043e\u0434\u043e\u0432")))}),void this.resetBoosterMode());default:return void this.resetBoosterMode()}},t.prototype.performBurnMove=function(t){var e=this;this.isBusy=!0,this.fieldView.playBurn(t,function(){e.fieldModel.applyBurn(t),e.fieldView.applyModelAnimated(e.fieldModel,function(){var o,i,s,n,r;e.gameState.movesLeft-=1;var l=t.length,c=10*l+5*Math.max(0,l-2);return e.gameState.score+=c,null===(o=e.hudView)||void 0===o||o.setMoves(e.gameState.movesLeft),null===(i=e.hudView)||void 0===i||i.setScore(e.gameState.score,e.gameState.targetScore),e.gameState.isWin()?(e.isBusy=!0,void(null===(s=e.onGameEnd)||void 0===s||s.call(e,"win","\u041e\u0447\u043a\u0438: "+e.gameState.score))):e.gameState.isLose()?(e.isBusy=!0,void(null===(n=e.onGameEnd)||void 0===n||n.call(e,"lose","\u0425\u043e\u0434\u044b \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c"))):e.fieldModel.hasAnyMove(e.MIN_GROUP)?void(e.isBusy=!1):(e.isBusy=!0,void(null===(r=e.onGameEnd)||void 0===r||r.call(e,"lose","\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0445\u043e\u0434\u043e\u0432")))})})},t}();o.default=n,cc._RF.pop()},{"../config/BoostersProgress":"BoostersProgress"}],GameScene:[function(t,e,o){"use strict";cc._RF.push(e,"423957/F1JOFLiaI+Lrm/8V","GameScene");var i,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var s,n=arguments.length,r=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(n<3?s(r):n>3?s(e,o,r):s(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../models/FieldModel"),l=t("../models/GameStateModel"),c=t("../views/FieldView"),a=t("../views/HUDView"),h=t("../views/BoostersView"),d=t("../controllers/GameController"),u=t("../views/ResultOverlayView"),p=t("../config/LevelConfig"),f=t("../config/Progress"),v=t("../config/BoostersProgress"),y=cc._decorator,b=y.ccclass,g=y.property,w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fieldView=null,e.hudView=null,e.boostersView=null,e.resultOverlayView=null,e}return s(e,t),e.prototype.start=function(){var t,e,o=this,i=this.getSafeLevelIndex(),s=p.LEVELS[i],n=i>=p.LEVELS.length-1;null===(t=this.hudView)||void 0===t||t.setLevel(i+1);var c=new r.default(8,8),a=new l.default(s.moves,s.targetScore);null===(e=this.fieldView)||void 0===e||e.setInputEnabled(!0);var h=new d.default(c,a,this.fieldView,this.hudView,this.boostersView);this.resultOverlayView&&(this.resultOverlayView.onRestart=function(){cc.director.loadScene(cc.director.getScene().name)},this.resultOverlayView.onNext=function(){n?(f.setLevelIndex(0),v.resetBoostersState({swapLeft:5,bombLeft:3})):f.setLevelIndex(i+1),cc.director.loadScene(cc.director.getScene().name)}),h.onGameEnd=function(t,e){var i;null===(i=o.fieldView)||void 0===i||i.setInputEnabled(!1),o.resultOverlayView&&("win"===t?o.resultOverlayView.show({type:"win",title:"\u041f\u043e\u0431\u0435\u0434\u0430!",body:e,canNext:!0,nextText:n?"PLAY AGAIN":"NEXT LEVEL"}):o.resultOverlayView.show({type:"lose",title:"\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435",body:e,canNext:!1,nextText:"NEXT LEVEL"}))}},e.prototype.getSafeLevelIndex=function(){var t=f.getLevelIndex();return t<0?0:t>=p.LEVELS.length?p.LEVELS.length-1:t},n([g(c.default)],e.prototype,"fieldView",void 0),n([g(a.default)],e.prototype,"hudView",void 0),n([g(h.default)],e.prototype,"boostersView",void 0),n([g(u.default)],e.prototype,"resultOverlayView",void 0),n([b],e)}(cc.Component);o.default=w,cc._RF.pop()},{"../config/BoostersProgress":"BoostersProgress","../config/LevelConfig":"LevelConfig","../config/Progress":"Progress","../controllers/GameController":"GameController","../models/FieldModel":"FieldModel","../models/GameStateModel":"GameStateModel","../views/BoostersView":"BoostersView","../views/FieldView":"FieldView","../views/HUDView":"HUDView","../views/ResultOverlayView":"ResultOverlayView"}],GameStateModel:[function(t,e,o){"use strict";cc._RF.push(e,"c05bdRFrc5C0pMjNlOF0Eci","GameStateModel"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t,e){this.movesLeft=t,this.score=0,this.targetScore=e}return t.prototype.isWin=function(){return this.score>=this.targetScore},t.prototype.isLose=function(){return this.movesLeft<=0&&!this.isWin()},t}();o.default=i,cc._RF.pop()},{}],HUDView:[function(t,e,o){"use strict";cc._RF.push(e,"082bb3vlR5AabnmPNP7qpAN","HUDView");var i,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var s,n=arguments.length,r=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(n<3?s(r):n>3?s(e,o,r):s(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,c=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.movesLabel=null,e.scoreValueLabel=null,e.levelLabel=null,e}return s(e,t),e.prototype.setMoves=function(t){this.movesLabel&&(this.movesLabel.string=String(t))},e.prototype.setScore=function(t,e){this.scoreValueLabel&&(this.scoreValueLabel.string=t+"/"+e)},e.prototype.setLevel=function(t){this.levelLabel&&(this.levelLabel.string="LEVEL "+t)},n([c(cc.Label)],e.prototype,"movesLabel",void 0),n([c(cc.Label)],e.prototype,"scoreValueLabel",void 0),n([c(cc.Label)],e.prototype,"levelLabel",void 0),n([l],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],LevelConfig:[function(t,e,o){"use strict";cc._RF.push(e,"cac94ET9LREXa72BkE4N9Os","LevelConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.LEVELS=void 0,o.LEVELS=[{moves:37,targetScore:500},{moves:30,targetScore:650},{moves:28,targetScore:800},{moves:20,targetScore:950},{moves:20,targetScore:1100}],cc._RF.pop()},{}],Progress:[function(t,e,o){"use strict";cc._RF.push(e,"fcdadVE9HxCor3Lhrqa4vbj","Progress"),Object.defineProperty(o,"__esModule",{value:!0}),o.setLevelIndex=o.getLevelIndex=void 0;o.getLevelIndex=function(){var t=cc.sys.localStorage.getItem("current_level"),e=t?parseInt(t,10):0;return isNaN(e)?0:e},o.setLevelIndex=function(t){cc.sys.localStorage.setItem("current_level",String(t))},cc._RF.pop()},{}],ResultOverlayView:[function(t,e,o){"use strict";cc._RF.push(e,"902e9bXoGBBFqdhZLFQQ2la","ResultOverlayView");var i,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var s,n=arguments.length,r=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(n<3?s(r):n>3?s(e,o,r):s(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,c=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dim=null,e.panel=null,e.titleLabel=null,e.bodyLabel=null,e.restartButton=null,e.nextButton=null,e.onRestart=null,e.onNext=null,e.lastType="lose",e.canNext=!1,e}return s(e,t),e.prototype.onLoad=function(){var t,e,o,i;this.node.active=!1,this.titleLabel||(this.titleLabel=(null===(t=cc.find("Panel/TitleLabel",this.node))||void 0===t?void 0:t.getComponent(cc.Label))||null),this.bodyLabel||(this.bodyLabel=(null===(e=cc.find("Panel/BodyLabel",this.node))||void 0===e?void 0:e.getComponent(cc.Label))||null),this.restartButton||(this.restartButton=(null===(o=cc.find("Panel/RestartButton",this.node))||void 0===o?void 0:o.getComponent(cc.Button))||null),this.nextButton||(this.nextButton=(null===(i=cc.find("Panel/NextButton",this.node))||void 0===i?void 0:i.getComponent(cc.Button))||null)},e.prototype.show=function(t){if(this.lastType=t.type,this.canNext=t.canNext,this.titleLabel&&(this.titleLabel.string=t.title),this.bodyLabel&&(this.bodyLabel.string=t.body),this.node.active=!0,this.dim&&this.dim.setSiblingIndex(0),this.panel&&this.panel.setSiblingIndex(this.node.childrenCount-1),this.dim&&(this.dim.zIndex=0),this.panel&&(this.panel.zIndex=10),this.restartButton&&(this.restartButton.node.zIndex=20),this.nextButton&&(this.nextButton.node.zIndex=20),this.nextButton){this.nextButton.node.active=this.canNext,this.nextButton.interactable=this.canNext;var e=this.nextButton.getComponentInChildren(cc.Label);e&&t.nextText&&(e.string=t.nextText)}},e.prototype.hide=function(){this.node.active=!1},e.prototype.onEnable=function(){var t,e;(null===(t=this.restartButton)||void 0===t?void 0:t.node)&&cc.isValid(this.restartButton.node)&&this.restartButton.node.on("click",this.handleRestart,this),(null===(e=this.nextButton)||void 0===e?void 0:e.node)&&cc.isValid(this.nextButton.node)&&this.nextButton.node.on("click",this.handleNext,this)},e.prototype.onDisable=function(){var t,e;(null===(t=this.restartButton)||void 0===t?void 0:t.node)&&cc.isValid(this.restartButton.node)&&this.restartButton.node.off("click",this.handleRestart,this),(null===(e=this.nextButton)||void 0===e?void 0:e.node)&&cc.isValid(this.nextButton.node)&&this.nextButton.node.off("click",this.handleNext,this)},e.prototype.handleRestart=function(){var t;null===(t=this.onRestart)||void 0===t||t.call(this)},e.prototype.handleNext=function(){var t;"win"===this.lastType&&this.canNext&&(null===(t=this.onNext)||void 0===t||t.call(this))},n([c(cc.Node)],e.prototype,"dim",void 0),n([c(cc.Node)],e.prototype,"panel",void 0),n([c(cc.Label)],e.prototype,"titleLabel",void 0),n([c(cc.Label)],e.prototype,"bodyLabel",void 0),n([c(cc.Button)],e.prototype,"restartButton",void 0),n([c(cc.Button)],e.prototype,"nextButton",void 0),n([l],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],TileModel:[function(t,e,o){"use strict";cc._RF.push(e,"104c0mtAGFBZY94oZOQNYZW","TileModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileColor=void 0,function(t){t.Blue="blue",t.Green="green",t.Red="red",t.Yellow="yellow",t.Purple="purple"}(o.TileColor||(o.TileColor={}));var i=1;o.default=function(t){this.isSpecial=!1,this.id=i++,this.color=t},cc._RF.pop()},{}],TileView:[function(t,e,o){"use strict";cc._RF.push(e,"06b94jGor9Oha4LZiLfBY+4","TileView");var i,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var s,n=arguments.length,r=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(n<3?s(r):n>3?s(e,o,r):s(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,c=r.property,a=t("../models/TileModel"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colorSprites=[],e.model=null,e.tileId=-1,e.sprite=null,e}return s(e,t),e.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite),this.updateView()},e.prototype.init=function(t){var e;this.model=t,this.tileId=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:-1,this.updateView()},e.prototype.updateView=function(){var t;if(this.model&&this.sprite){var e=((t={})[a.TileColor.Blue]=0,t[a.TileColor.Green]=1,t[a.TileColor.Red]=2,t[a.TileColor.Yellow]=3,t[a.TileColor.Purple]=4,t)[this.model.color],o=this.colorSprites[e];o&&(this.sprite.spriteFrame=o)}},n([c([cc.SpriteFrame])],e.prototype,"colorSprites",void 0),n([l],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../models/TileModel":"TileModel"}]},{},["BoostersProgress","LevelConfig","Progress","GameController","GameScene","FieldModel","GameStateModel","TileModel","BoostersView","FieldView","HUDView","ResultOverlayView","TileView"]);